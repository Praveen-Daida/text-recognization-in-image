<!DOCTYPE html>
<html lang="en" >
<head>
<meta charset="UTF-8">
<title>To Search for  Telugu and Urdu and word in a image</title>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/Dropify/0.2.2/css/dropify.min.css'>
<link href="https://fonts.googleapis.com/css?family=Courgette&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Neucha&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Changa+One&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Zhi+Mang+Xing&display=swap" rel="stylesheet"> 
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<style>
.dropify-font-upload:before, .dropify-wrapper .dropify-message span.file-icon:before {
    content: '\e800';
}
.dropify-font:before, .dropify-wrapper .dropify-message span.file-icon:before, .dropify-wrapper .dropify-preview .dropify-infos .dropify-infos-inner p.dropify-filename span.file-icon:before, [class*=" dropify-font-"]:before, [class^=dropify-font-]:before {
    font-family: dropify;
    font-style: normal;
    font-weight: 550;
    speak: none;
    display: inline-block;
    text-decoration: inherit;
    width: 1em;
    margin-left: .2em;
    margin-right: .2em;
    text-align: center;
    font-variant: normal;
    text-transform: none;
    line-height: 1em;
    font-size:8rem;
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #a81515fa; border-radius: 0px 15px ;">
  <div class="container-fluid d-flex justify-content-between">
    <div>
    <a class="navbar-brand" href="/">
      <img src="./logo1.png" alt="" width="40" height="40" >
    </a>
    <a style="font-size: 35px;" class="navbar-brand" href="/">Langugae Text Extractor</a>
  </div>
  <div>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a style="font-size: 18px;" class="nav-link active" aria-current="page" href="#how_to">Help</a>
        </li>
        <li class="nav-item">
          <a style="font-size: 18px;" class="nav-link active" href="#features">Features</a>
        </li>
      </ul>
    </div>
  </div>
  </div>
</nav>
<!-- Navbar End -->


<!-- input and output start -->
<section>
  <div class="row">
    <div class="col l7 offset-l1 m8 s12" style="margin-top:4%">
      <div class="card-panel hoverable z-depth-1" style="padding:0px">
        <form action="" class="row">
          <input id="file-input" type="file" class="dropify" data-default-file="" data-height="300" data-max-file-size="50M" data-allowed-file-extensions="png jpeg jpg pdf">
        </form>
      </div>
      <div class="col l12 m12 s12">
        <div class="card-panel" id="output-box" style="display: none;">
          <h4 class='center lime-text text-darken-1' style="font-family:'Changa One', cursive;">Output</h4>
            <div class="input-field">
              <i class="material-icons prefix">search</i>
              <input class="search-input" id="search" type="text" placeholder="Search for Words..." autocomplete="off">
            </div>
            <div id="output" class="content">
        </div>
    </div>
  </div>
</div>
<div class="col l3 m4 s12" style="margin-top:4%;">
<div class="card-panel" id="log-data" style="display:none;font-family: 'Arapey', serif;">
<h4 class="center lime-text text-darken-4" style="font-family: 'Neucha', cursive;">Progress</h4>
</div>
</div>
</section>
<!-- input output ends -->

<div class="row">
  <div class="card text-dark bg-info mb-3 mx-5" style="max-width: 35rem;">
    <div style="font-size: 35px;" id="how_to" class="card-header">How to Use ?</div>
    <div class="card-body">
      <p style="font-size: large;" class="card-text">1. Click on the above file upload box and choose the file you want to extract texts from.</p>
      <p style="font-size: large;" class="card-text">2. Wait till the model does its work of extracting texts, you can see the progress on right side.</p>
      <p style="font-size: large;" class="card-text">3. Once the output is ready it will be available below the file upload box.</p>
    </div>
  </div>
  <div class="card text-dark bg-info mb-3 mx-5" style="max-width: 35rem;">
    <div style="font-size: 35px;" id="how_to" class="card-header">Features</div>
    <div class="card-body">
      <p style="font-size: large;" class="card-text">1. Supports for all image formats</p>
      <p style="font-size: large;" class="card-text">2. Supports for Telugu and Urdu and English</p>
      <p style="font-size: large;" class="card-text">3. User friendly and gives quick response</p>
      <p style="font-size: large;" class="card-text">4. Search and Highlight</p>
    </div>
  </div>
</div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/Dropify/0.2.2/js/dropify.min.js'></script>
<script  src="./script.js"></script>
<script src="./tesseract/tesseract.min.js"></script>
<script src="./search.js"></script>
<script>
let log_data=document.getElementById("log-data")
let output=document.getElementById("output")
let output_box=document.getElementById("output-box")
function init(e)
{
  if (this.files && this.files[0]) {
    var reader = new FileReader();
    
    reader.onload = function(e) {
      img = e.target.result
      console.log("Image : ",img);
    }
    reader.readAsDataURL(this.files[0]);
  }
  count=0;
  output.innerHTML=''
  output_box.style.display="none"
  output.style.display="none"
  img_name=this.files[0].name
  log_data.innerHTML=`<h4 class='center lhime-text text-darken-4' style="font-family: 'Neucha', cursive;">Progress</h4>`

  // createWorker is a factory act wofunction that creates a tesserrker, 
  // a worker is basically a Web Worker in browser and Child Process in Node.

  // corePath path for tesseract-core.js script
  // langPath path for downloading traineddata, do not include / at the end of the path
  // workerPath path for downloading worker script
  // logger a function to log the progress, a quick example is m => console.log(m)

  const { createWorker } = Tesseract; //object destructuring
    const worker = createWorker({
      workerPath: './tesseract/worker.min.js',
      langPath: '../lang-data',
      corePath: './tesseract/tesseract-core.wasm.js',
      logger: m => {
        count=count+1
        console.log(count);
        log_data.style.display="block"
        log_data.innerHTML+="<span class='grey-text'>Progress "+Math.round(m.progress*100,0)+"%</span> : <span class='red-text'>"+m.status+"...</span><br>"
        if(count>7)
        {
          log_data.innerHTML=`<h4 class='center lime-text text-darken-4' style="font-family: 'Neucha', cursive;">Progress</h4>`
          count=0
        }
    },
  });

    (async () => {
      // Worker.load() loads tesseract.js-core scripts 
      // (download from remote if not presented), it makes Web Worker/
      // Child Process ready for next action.
      await worker.load();
      // Worker.loadLanguage() loads traineddata from cache or download traineddata from remote, 
      // and put traineddata into the WebAssembly file system.
      await worker.loadLanguage('eng+urd+tel+tha');
      //Worker.initialize() initializes the Tesseract API, make sure it is ready for doing OCR tasks.
      await worker.initialize('eng+urd+tel+tha');
      // Worker.recognize() provides core function of Tesseract.js as it executes OCR
      // Figures out what words are in image, where the words are in image
      const { data: { text } } = await worker.recognize(img);
      output_box.style.display="block"
      output.style.display="block"
      output.innerHTML+=text
      log_data.innerHTML+="<b class='green-text'>Text extracted successfully...</b>"
      console.log(text);
      await worker.terminate();
      setup();
    })();
  }
  let file_input=document.getElementById("file-input")
  file_input.addEventListener("change",init)
  </script>
</body>
</html>
